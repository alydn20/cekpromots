<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Shield Network Protection</title>
    <link rel="manifest" id="manifestLink">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 0;
        }

        .topbar {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .topbar-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .install-badge {
            background: #e74c3c;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .install-badge.installed {
            background: #27ae60;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Install Required Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .modal-text {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .btn-install {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            transition: all 0.3s ease;
        }

        .btn-install:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);
        }

        .btn-install:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .card.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
        }

        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge.locked {
            background: #fff3cd;
            color: #856404;
        }

        .metric {
            text-align: center;
            padding: 20px;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #27ae60;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        input:disabled + .slider {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .lock-overlay {
            position: relative;
        }

        .lock-overlay::after {
            content: 'ðŸ”’';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            opacity: 0;
            pointer-events: none;
        }

        .lock-overlay.locked::after {
            opacity: 0.3;
        }

        .domain-table {
            width: 100%;
            border-collapse: collapse;
        }

        .domain-table thead {
            background: #f8f9fa;
        }

        .domain-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        .domain-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            color: #495057;
        }

        .domain-table tbody tr:hover {
            background: #f8f9fa;
        }

        .domain-name {
            font-family: 'Courier New', monospace;
            color: #2c3e50;
            font-weight: 500;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 1em;
            transition: border 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95em;
        }

        .btn-primary {
            background: #2c3e50;
            color: white;
        }

        .btn-primary:hover {
            background: #34495e;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
            padding: 8px 16px;
            font-size: 0.85em;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .export-section {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .export-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            display: block;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre;
            line-height: 1.6;
        }

        .action-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .install-prompt {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .install-prompt h3 {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .topbar-content {
                flex-direction: column;
                gap: 15px;
            }

            .input-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .modal-content {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Install Required Modal -->
    <div class="modal" id="installModal">
        <div class="modal-content">
            <div class="modal-icon">ðŸ”’</div>
            <div class="modal-title">Installation Required</div>
            <div class="modal-text">
                To activate protection, you must first install this application. 
                Click the button below to install Shield Network Protection.
            </div>
            <button class="btn-install" id="installBtn" onclick="installPWA()">
                Install Application
            </button>
            <p style="margin-top: 20px; color: #7f8c8d; font-size: 0.9em;">
                Protection features are locked until installation is complete.
            </p>
        </div>
    </div>

    <div class="topbar">
        <div class="topbar-content">
            <div class="logo">
                Shield Network Protection
            </div>
            <div>
                <span class="install-badge" id="installStatus">Not Installed</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Install Prompt (visible when not installed) -->
        <div class="install-prompt" id="installPrompt" style="display: none;">
            <h3>ðŸ”’ Installation Required</h3>
            <p style="margin: 10px 0;">Install the app to unlock all protection features</p>
            <button class="btn-install" onclick="showInstallModal()" style="margin-top: 10px;">
                Install Now
            </button>
        </div>

        <!-- Metrics Grid -->
        <div class="grid">
            <div class="card" id="metricCard1">
                <div class="metric lock-overlay" id="metricLock1">
                    <div class="metric-value" id="blockedCount">0</div>
                    <div class="metric-label">Blocked Requests</div>
                </div>
            </div>
            <div class="card" id="metricCard2">
                <div class="metric lock-overlay" id="metricLock2">
                    <div class="metric-value" id="allowedCount">0</div>
                    <div class="metric-label">Allowed Requests</div>
                </div>
            </div>
            <div class="card" id="metricCard3">
                <div class="metric lock-overlay" id="metricLock3">
                    <div class="metric-value" id="domainsCount">3</div>
                    <div class="metric-label">Protected Domains</div>
                </div>
            </div>
        </div>

        <!-- Protection Status -->
        <div class="card" id="protectionCard">
            <div class="card-header">
                <div class="card-title">Protection Status</div>
                <span class="status-badge locked" id="statusBadge">Locked</span>
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <label class="toggle-switch">
                    <input type="checkbox" id="protectionToggle" disabled onchange="toggleProtection()">
                    <span class="slider"></span>
                </label>
                <div>
                    <div style="font-weight: 600; color: #2c3e50; margin-bottom: 5px;">DNS Filtering</div>
                    <div style="color: #7f8c8d; font-size: 0.9em;" id="protectionDesc">
                        Install app to activate protection
                    </div>
                </div>
            </div>
        </div>

        <!-- Domain Management -->
        <div class="card" id="domainCard">
            <div class="card-header">
                <div class="card-title">Blocked Domains</div>
            </div>
            <table class="domain-table">
                <thead>
                    <tr>
                        <th>Domain</th>
                        <th>Status</th>
                        <th style="width: 100px;">Action</th>
                    </tr>
                </thead>
                <tbody id="domainTableBody">
                    <!-- Populated by JS -->
                </tbody>
            </table>

            <div class="input-group">
                <input type="text" id="newDomain" placeholder="Enter domain to block (e.g., example.com)" disabled>
                <button class="btn btn-primary" onclick="addDomain()" disabled>Add Domain</button>
                <button class="btn btn-secondary" onclick="resetDomains()" disabled>Reset</button>
            </div>
        </div>

        <!-- Export Configuration -->
        <div class="card" id="exportCard">
            <div class="card-header">
                <div class="card-title">Export Configuration</div>
            </div>
            <div class="export-section">
                <span class="export-label">DNS Rules:</span>
                <div class="code-block" id="exportConfig">||csftr.com^
||ap-device-pro.csftr.com^
||api.csftr.com^</div>
                <div class="action-row">
                    <div style="color: #7f8c8d; font-size: 0.9em;">Copy and paste into your DNS filtering application</div>
                    <button class="btn btn-primary" onclick="copyConfig()">Copy Rules</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PWA Installation
        let deferredPrompt;
        let isInstalled = false;

        // Generate dynamic manifest
        const manifestData = {
            "name": "Shield Network Protection",
            "short_name": "Shield",
            "description": "DNS Filtering Management",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#2c3e50",
            "theme_color": "#2c3e50",
            "orientation": "portrait-primary",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232c3e50'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white'%3EðŸ›¡ï¸%3C/text%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                },
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232c3e50'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle' fill='white'%3EðŸ›¡ï¸%3C/text%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifestLink').setAttribute('href', manifestURL);

        // State Management
        let state = {
            enabled: false,
            domains: [
                'csftr.com',
                'ap-device-pro.csftr.com',
                'api.csftr.com'
            ],
            stats: {
                blocked: 0,
                allowed: 0
            }
        };

        // Check if already installed
        function checkInstallation() {
            // Check if running as PWA
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                isInstalled = true;
                unlockFeatures();
            } else {
                // Check localStorage flag
                if (localStorage.getItem('pwaInstalled') === 'true') {
                    isInstalled = true;
                    unlockFeatures();
                } else {
                    lockFeatures();
                }
            }
        }

        // Lock features when not installed
        function lockFeatures() {
            document.getElementById('installPrompt').style.display = 'block';
            document.getElementById('installStatus').textContent = 'Not Installed';
            document.getElementById('installStatus').classList.remove('installed');
            document.getElementById('statusBadge').textContent = 'Locked';
            document.getElementById('statusBadge').className = 'status-badge locked';
            
            // Disable all controls
            document.getElementById('protectionToggle').disabled = true;
            document.getElementById('newDomain').disabled = true;
            document.querySelectorAll('.btn-primary, .btn-secondary').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
            });

            // Add lock overlay
            ['metricLock1', 'metricLock2', 'metricLock3'].forEach(id => {
                document.getElementById(id).classList.add('locked');
            });

            // Show modal on first visit
            if (!localStorage.getItem('modalShown')) {
                setTimeout(() => {
                    document.getElementById('installModal').classList.add('active');
                    localStorage.setItem('modalShown', 'true');
                }, 1000);
            }
        }

        // Unlock features when installed
        function unlockFeatures() {
            isInstalled = true;
            document.getElementById('installPrompt').style.display = 'none';
            document.getElementById('installStatus').textContent = 'Installed';
            document.getElementById('installStatus').classList.add('installed');
            document.getElementById('installModal').classList.remove('active');
            document.getElementById('protectionDesc').textContent = 'Block malicious domains and trackers';
            
            // Enable all controls
            document.getElementById('protectionToggle').disabled = false;
            document.getElementById('newDomain').disabled = false;
            document.querySelectorAll('.btn-primary, .btn-secondary').forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
            });

            // Remove lock overlay
            ['metricLock1', 'metricLock2', 'metricLock3'].forEach(id => {
                document.getElementById(id).classList.remove('locked');
            });

            // Start simulation
            startSimulation();
        }

        // Show install modal
        function showInstallModal() {
            document.getElementById('installModal').classList.add('active');
        }

        // Install PWA
        function installPWA() {
            const installBtn = document.getElementById('installBtn');
            
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installed');
                        localStorage.setItem('pwaInstalled', 'true');
                        unlockFeatures();
                    }
                    deferredPrompt = null;
                });
            } else {
                // Manual installation (for iOS or when prompt not available)
                if (confirm('To install:\n\n1. Tap Share button\n2. Select "Add to Home Screen"\n3. Tap "Add"\n\nAfter installation, reopen the app from your home screen.')) {
                    localStorage.setItem('pwaInstalled', 'true');
                    unlockFeatures();
                }
            }
        }

        // Listen for install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').disabled = false;
        });

        // Listen for app installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            localStorage.setItem('pwaInstalled', 'true');
            unlockFeatures();
        });

        // Initialize
        function init() {
            checkInstallation();
            loadState();
            updateUI();
        }

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('networkProtectionState');
            if (saved) {
                state = JSON.parse(saved);
            }
        }

        // Save state
        function saveState() {
            localStorage.setItem('networkProtectionState', JSON.stringify(state));
        }

        // Toggle protection (only if installed)
        function toggleProtection() {
            if (!isInstalled) {
                showInstallModal();
                return;
            }
            state.enabled = document.getElementById('protectionToggle').checked;
            updateUI();
            saveState();
        }

        // Update UI
        function updateUI() {
            if (!isInstalled) return;

            // Status badge
            const badge = document.getElementById('statusBadge');
            badge.textContent = state.enabled ? 'Active' : 'Inactive';
            badge.className = `status-badge ${state.enabled ? 'active' : 'inactive'}`;

            // Toggle
            document.getElementById('protectionToggle').checked = state.enabled;

            // Stats
            document.getElementById('blockedCount').textContent = state.stats.blocked.toLocaleString();
            document.getElementById('allowedCount').textContent = state.stats.allowed.toLocaleString();
            document.getElementById('domainsCount').textContent = state.domains.length;

            // Domain table
            renderDomains();

            // Export config
            updateExportConfig();
        }

        // Render domain table
        function renderDomains() {
            const tbody = document.getElementById('domainTableBody');
            tbody.innerHTML = '';

            state.domains.forEach((domain, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="domain-name">${domain}</span></td>
                    <td><span class="status-badge ${state.enabled ? 'active' : 'inactive'}">${state.enabled ? 'Blocked' : 'Inactive'}</span></td>
                    <td>
                        <button class="btn btn-danger" onclick="removeDomain(${index})" ${!isInstalled ? 'disabled' : ''}>Remove</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Add domain
        function addDomain() {
            if (!isInstalled) {
                showInstallModal();
                return;
            }

            const input = document.getElementById('newDomain');
            const domain = input.value.trim().toLowerCase();

            if (!domain) {
                alert('Please enter a domain');
                return;
            }

            const cleanDomain = domain.replace(/^https?:\/\//, '').replace(/\/$/, '');

            if (state.domains.includes(cleanDomain)) {
                alert('Domain already exists');
                return;
            }

            state.domains.push(cleanDomain);
            input.value = '';
            updateUI();
            saveState();
        }

        // Remove domain
        function removeDomain(index) {
            if (!isInstalled) {
                showInstallModal();
                return;
            }

            if (confirm('Remove this domain from the blocklist?')) {
                state.domains.splice(index, 1);
                updateUI();
                saveState();
            }
        }

        // Reset domains
        function resetDomains() {
            if (!isInstalled) {
                showInstallModal();
                return;
            }

            if (confirm('Reset to default domains?')) {
                state.domains = [
                    'csftr.com',
                    'ap-device-pro.csftr.com',
                    'api.csftr.com'
                ];
                updateUI();
                saveState();
            }
        }

        // Update export config
        function updateExportConfig() {
            const config = state.domains.map(d => `||${d}^`).join('\n');
            document.getElementById('exportConfig').textContent = config;
        }

        // Copy configuration
        function copyConfig() {
            const config = document.getElementById('exportConfig').textContent;
            navigator.clipboard.writeText(config).then(() => {
                const btn = event.target;
                const original = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#27ae60';
                setTimeout(() => {
                    btn.textContent = original;
                    btn.style.background = '';
                }, 2000);
            }).catch(() => {
                alert('Failed to copy. Please select and copy manually.');
            });
        }

        // Simulate activity (only when installed and active)
        function startSimulation() {
            setInterval(() => {
                if (isInstalled && state.enabled && Math.random() > 0.4) {
                    state.stats.blocked++;
                    saveState();
                    updateUI();
                }
            }, 3000);

            setInterval(() => {
                if (isInstalled && Math.random() > 0.6) {
                    state.stats.allowed++;
                    saveState();
                    updateUI();
                }
            }, 2000);
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            const swCode = `
                self.addEventListener('install', (e) => {
                    console.log('Service Worker installed');
                    self.skipWaiting();
                });

                self.addEventListener('activate', (e) => {
                    console.log('Service Worker activated');
                    return self.clients.claim();
                });

                self.addEventListener('fetch', (e) => {
                    e.respondWith(fetch(e.request));
                });
            `;

            const swBlob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(swBlob);

            navigator.serviceWorker.register(swUrl).then((registration) => {
                console.log('ServiceWorker registered');
            }).catch((err) => {
                console.log('ServiceWorker registration failed: ', err);
            });
        }

        // Start
        init();
    </script>
</body>
</html>
